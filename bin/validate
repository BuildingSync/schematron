#!/usr/bin/ruby

include LibXML
include LibXSLT

require 'schematron'

# Get sch and xml from command line
schema_doc = XML::Document.file ARGV[0]
instance_doc = XML::Document.file ARGV[1]

stron = Schematron::Schema.new schema_doc
stron.validate instance_doc

# Print the errors
results_doc.root.find('//svrl:failed-assert', NS_PREFIXES).each do |assert|
  context = instance_doc.root.find_first assert['location']

  assert.find('svrl:text/text()', NS_PREFIXES).each do |message|
    puts '%s "%s" on line %d: %s' % [ context.node_type_name,
                                      context.name,
                                      context.line_num,
                                      message.content.strip ]
  end

end
